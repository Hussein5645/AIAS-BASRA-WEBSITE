<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magazine - AIAS Basra Chapter</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Authentication Check -->
    <script type="module" src="js/auth.js"></script>
    <style>
        .magazine-hero {
            background: var(--gradient-1);
            color: var(--white);
            padding: 8rem 0 4rem;
            text-align: center;
        }
        
        .magazine-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .featured-article {
            padding: 5rem 0;
            background: var(--light-bg);
        }
        
        .featured-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: center;
        }
        
        .featured-image {
            height: 400px;
            background: var(--gradient-2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6rem;
            box-shadow: var(--shadow-lg);
        }
        
        .featured-text h2 {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .article-date {
            color: var(--accent-color);
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .featured-text p {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 1.5rem;
        }
        
        .articles-section {
            padding: 5rem 0;
        }
        
        .view-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .view-toggle {
            display: flex;
            gap: 0.5rem;
            background: var(--light-bg);
            padding: 0.5rem;
            border-radius: 8px;
        }
        
        .view-btn {
            padding: 0.75rem 1.25rem;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 600;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .view-btn span {
            font-size: 1.1rem;
        }
        
        .view-btn:hover {
            background: var(--white);
            color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .view-btn.active {
            background: var(--gradient-1);
            color: var(--white);
            box-shadow: var(--shadow-sm);
        }
        
        .view-btn.active:hover {
            transform: scale(1.05);
        }
        
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            transition: all 0.3s ease;
        }
        
        /* Grid View (Default) */
        .articles-grid.view-grid {
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        }
        
        /* List View */
        .articles-grid.view-list {
            grid-template-columns: 1fr;
        }
        
        .articles-grid.view-list .article-card {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 0;
        }
        
        .articles-grid.view-list .article-image {
            height: 100%;
            min-height: 200px;
        }
        
        .articles-grid.view-list .article-content {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        /* Compact Grid View */
        .articles-grid.view-compact {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        
        .articles-grid.view-compact .article-card {
            font-size: 0.9rem;
        }
        
        .articles-grid.view-compact .article-image {
            height: 160px;
            font-size: 3rem;
        }
        
        .articles-grid.view-compact .article-content {
            padding: 1rem;
        }
        
        .articles-grid.view-compact .article-title {
            font-size: 1.1rem;
        }
        
        .articles-grid.view-compact .article-excerpt {
            font-size: 0.85rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Large Grid View */
        .articles-grid.view-large {
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 3rem;
        }
        
        .articles-grid.view-large .article-image {
            height: 280px;
            font-size: 5rem;
        }
        
        .articles-grid.view-large .article-content {
            padding: 2rem;
        }
        
        .articles-grid.view-large .article-title {
            font-size: 1.5rem;
        }
        
        .article-card {
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all 0.4s ease;
            cursor: pointer;
            perspective: 1000px;
        }
        
        .article-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-xl);
        }
        
        .article-image {
            height: 220px;
            background: var(--gradient-2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            position: relative;
            overflow: hidden;
        }
        
        .article-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.3) 100%);
        }
        
        .article-category {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: var(--white);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary-color);
            z-index: 1;
        }
        
        .article-content {
            padding: 1.5rem;
        }
        
        .article-meta {
            display: flex;
            gap: 1rem;
            color: var(--text-light);
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }
        
        .article-title {
            font-size: 1.25rem;
            color: var(--primary-color);
            margin-bottom: 0.75rem;
            font-weight: 600;
            line-height: 1.4;
        }
        
        .article-excerpt {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .read-more {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--accent-color);
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .read-more:hover {
            gap: 1rem;
        }
        
        .magazine-releases {
            padding: 5rem 0;
            background: var(--white);
        }
        
        .releases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }
        
        .release-card {
            background: var(--white);
            border: 2px solid var(--light-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .release-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-color);
        }
        
        .release-preview {
            background: var(--gradient-1);
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            color: var(--white);
            position: relative;
            overflow: hidden;
        }
        
        .release-preview::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.3) 100%);
        }
        
        .release-info {
            padding: 1.5rem;
        }
        
        .release-title {
            font-size: 1.25rem;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .release-date {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .release-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .release-btn {
            flex: 1;
            min-width: 120px;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .btn-view {
            background: var(--gradient-1);
            color: var(--white);
        }
        
        .btn-view:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }
        
        .btn-download {
            background: var(--white);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }
        
        .btn-download:hover {
            background: var(--primary-color);
            color: var(--white);
        }
        
        .empty-releases {
            text-align: center;
            padding: 4rem 2rem;
            background: var(--light-bg);
            border-radius: 12px;
        }
        
        .empty-releases-icon {
            font-size: 5rem;
            margin-bottom: 1rem;
        }
        
        .empty-releases h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        
        .empty-releases p {
            color: var(--text-secondary);
        }
        
        /* PDF Viewer Modal */
        .pdf-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            overflow: hidden;
        }
        
        .pdf-modal.active {
            display: flex;
            flex-direction: column;
        }
        
        .pdf-modal-header {
            background: var(--primary-color);
            color: var(--white);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pdf-modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .pdf-modal-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 2rem;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .pdf-modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .pdf-modal-content {
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        .pdf-viewer-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        @media (max-width: 768px) {
            .magazine-hero h1 {
                font-size: 2rem;
            }
            
            .featured-content {
                grid-template-columns: 1fr;
            }
            
            .releases-grid {
                grid-template-columns: 1fr;
            }
            
            .release-actions {
                flex-direction: column;
            }
            
            .release-btn {
                width: 100%;
            }
            
            .view-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .view-toggle {
                width: 100%;
                justify-content: center;
            }
            
            .articles-grid.view-list .article-card {
                grid-template-columns: 1fr;
            }
            
            .articles-grid.view-list .article-image {
                height: 200px;
            }
            
            .articles-grid.view-large {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="container">
            <div class="nav-content">
                <div class="logo">
                    <img src="static/images/branding/LOGO.png" alt="AIAS Basra Logo">
                    <span>AIAS Basra</span>
                </div>
                <button class="menu-toggle" id="menuToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <ul class="nav-links" id="navLinks">
                    <li><a href="index.html" data-en="Home" data-ar="ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©">Home</a></li>
                    <li><a href="events.html" data-en="Events" data-ar="ÿßŸÑŸÅÿπÿßŸÑŸäÿßÿ™">Events</a></li>
                    <li><a href="education.html" data-en="Education" data-ar="ÿßŸÑÿ™ÿπŸÑŸäŸÖ">Education</a></li>
                    <li><a href="magazine.html" class="active" data-en="Magazine" data-ar="ÿßŸÑŸÖÿ¨ŸÑÿ©">Magazine</a></li>
                    <li><a href="library.html" data-en="Library" data-ar="ÿßŸÑŸÖŸÉÿ™ÿ®ÿ©">Library</a></li>
                    <li><a href="about.html" data-en="About Us" data-ar="ŸÖŸÜ ŸÜÿ≠ŸÜ">About Us</a></li>
                    <li>
                        <button class="language-toggle" id="languageToggle">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                            </svg>
                            <span id="currentLang">EN</span>
                        </button>
                    </li>
                    <li id="dashboardBtn" style="display: none;"><a href="admin-dashboard.html" class="nav-btn nav-btn-signup" data-en="Dashboard" data-ar="ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ">Dashboard</a></li>
                    <li id="loginBtn"><a href="login.html" class="nav-btn nav-btn-login" data-en="Login" data-ar="ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ">Login</a></li>
                    <li id="signupBtn"><a href="signup.html" class="nav-btn nav-btn-signup" data-en="Sign Up" data-ar="ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®">Sign Up</a></li>
                    <li id="userProfile" style="display: none;">
                        <span id="userName" style="color: #667eea; font-weight: 600; margin-right: 10px;"></span>
                        <a href="#" id="logoutBtn" class="nav-btn nav-btn-login" data-en="Logout" data-ar="ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Magazine Hero -->
    <section class="magazine-hero">
        <div class="container">
            <h1 class="fade-in-up" data-en="Magazine & Articles" data-ar="ÿßŸÑŸÖÿ¨ŸÑÿ© ŸàÿßŸÑŸÖŸÇÿßŸÑÿßÿ™">Magazine & Articles</h1>
            <p class="fade-in-up delay-1" data-en="Explore insights, trends, and stories from the world of architecture" data-ar="ÿßÿ≥ÿ™ŸÉÿ¥ŸÅ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ŸàÿßŸÑÿßÿ™ÿ¨ÿßŸáÿßÿ™ ŸàÿßŸÑŸÇÿµÿµ ŸÖŸÜ ÿπÿßŸÑŸÖ ÿßŸÑŸáŸÜÿØÿ≥ÿ© ÿßŸÑŸÖÿπŸÖÿßÿ±Ÿäÿ©">Explore insights, trends, and stories from the world of architecture</p>
        </div>
    </section>



    <!-- Magazine Releases -->
    <section class="magazine-releases">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title" data-en="Magazine Releases" data-ar="ÿ•ÿµÿØÿßÿ±ÿßÿ™ ÿßŸÑŸÖÿ¨ŸÑÿ©">Magazine Releases</h2>
                <p class="section-subtitle" data-en="Download and read our latest magazine issues" data-ar="ÿ≠ŸÖŸÑ ŸàÿßŸÇÿ±ÿ£ ÿ£ÿ≠ÿØÿ´ ÿ•ÿµÿØÿßÿ±ÿßÿ™ ŸÖÿ¨ŸÑÿ™ŸÜÿß">Download and read our latest magazine issues</p>
            </div>
            <div class="releases-grid" id="releasesGrid">
                <!-- Magazine releases will be loaded here -->
                <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">‚è≥</div>
                    <p style="color: var(--text-secondary);">Loading magazine releases...</p>
                </div>
            </div>
        </div>
    </section>


    <!-- Articles Section -->
    <section class="articles-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title" data-en="Latest Articles" data-ar="ÿ£ÿ≠ÿØÿ´ ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™">Latest Articles</h2>
                <p class="section-subtitle" data-en="Stay updated with the latest insights and stories" data-ar="ÿßÿ®ŸÇ ÿπŸÑŸâ ÿßÿ∑ŸÑÿßÿπ ÿ®ÿ£ÿ≠ÿØÿ´ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ŸàÿßŸÑŸÇÿµÿµ">Stay updated with the latest insights and stories</p>
            </div>
            <div class="view-controls">
                <div></div>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="grid" data-target="latestArticles">
                        <span>‚ñ¶</span> Grid
                    </button>
                    <button class="view-btn" data-view="list" data-target="latestArticles">
                        <span>‚ò∞</span> List
                    </button>
                    <button class="view-btn" data-view="compact" data-target="latestArticles">
                        <span>‚ñ™</span> Compact
                    </button>
                </div>
            </div>
            <div class="articles-grid view-grid" id="latestArticles">
                <!-- Latest articles will be loaded here -->
            </div>
        </div>
    </section>





    <!-- All Articles Section -->
    <section class="articles-section" style="background: var(--light-bg);">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title" data-en="All Articles" data-ar="ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™">All Articles</h2>
                <p class="section-subtitle" data-en="Browse our complete collection of articles" data-ar="ÿ™ÿµŸÅÿ≠ ŸÖÿ¨ŸÖŸàÿπÿ™ŸÜÿß ÿßŸÑŸÉÿßŸÖŸÑÿ© ŸÖŸÜ ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™">Browse our complete collection of articles</p>
            </div>
            <div class="view-controls">
                <div></div>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="grid" data-target="allArticles">
                        <span>‚ñ¶</span> Grid
                    </button>
                    <button class="view-btn" data-view="list" data-target="allArticles">
                        <span>‚ò∞</span> List
                    </button>
                    <button class="view-btn" data-view="compact" data-target="allArticles">
                        <span>‚ñ™</span> Compact
                    </button>
                </div>
            </div>
            <div class="articles-grid view-grid" id="allArticles">
                <!-- All articles will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>AIAS Basra Chapter</h3>
                    <p>American Institute of Architecture Students - Basra Chapter</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="events.html">Events</a></li>
                        <li><a href="library.html">Library</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact Us</h4>
                    <p style="margin-bottom: 0.5rem;">
                        <a href="mailto:basrah@aias.org" style="color: inherit; text-decoration: none;">
                            üìß basrah@aias.org
                        </a>
                    </p>
                    <p style="margin-bottom: 0.5rem;">
                        <a href="https://instagram.com/aias.bsr" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none;">
                            üì∑ Instagram: @aias.bsr
                        </a>
                    </p>
                    <p style="margin-bottom: 0.5rem;">
                        <a href="https://x.com/aiasbasra" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none;">
                            ùïè X: @aiasbasra
                        </a>
                    </p>
                    <p style="margin-bottom: 0.5rem;">
                        <a href="https://www.tiktok.com/@aiasbsr" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none;">
                            üéµ TikTok: @aiasbsr
                        </a>
                    </p>
                    <p style="margin-bottom: 1rem;">
                        <a href="https://www.facebook.com/share/19mEUHcFQs/?mibextid=wwXIfr" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none;">
                            üìò Facebook
                        </a>
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 AIAS Basra Chapter. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- PDF Viewer Modal -->
    <div class="pdf-modal" id="pdfModal">
        <div class="pdf-modal-header">
            <div class="pdf-modal-title" id="pdfModalTitle">Magazine Preview</div>
            <button class="pdf-modal-close" id="pdfModalClose" aria-label="Close">&times;</button>
        </div>
        <div class="pdf-modal-content">
            <iframe class="pdf-viewer-iframe" id="pdfViewerFrame"></iframe>
        </div>
    </div>

    <script src="js/three-effects.js"></script>
    <script src="js/main.js"></script>
    <script type="module">
        // Import Data Loader
        import dataLoader from "./js/data-loader.js";

        // Debug toggle: enable via ?debug=true or localStorage.setItem('debug','true')
        const DEBUG =
          (new URLSearchParams(window.location.search).has('debug') ||
           localStorage.getItem('debug') === 'true');

        // Magazine releases configuration
        const RELEASES_FOLDER = 'static/magazine-releases/';
        
        // PDF Modal functionality
        function initPDFModal() {
            const modal = document.getElementById('pdfModal');
            const closeBtn = document.getElementById('pdfModalClose');
            const iframe = document.getElementById('pdfViewerFrame');
            
            window.openPDFViewer = function(pdfUrl, title) {
                document.getElementById('pdfModalTitle').textContent = title;
                iframe.src = pdfUrl;
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            };
            
            window.closePDFViewer = function() {
                modal.classList.remove('active');
                iframe.src = '';
                document.body.style.overflow = '';
            };
            
            closeBtn.addEventListener('click', window.closePDFViewer);
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    window.closePDFViewer();
                }
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal.classList.contains('active')) {
                    window.closePDFViewer();
                }
            });
        }
        
        // Load magazine releases from static folder
        async function loadMagazineReleases() {
            const releasesGrid = document.getElementById('releasesGrid');
            
            if (!releasesGrid) return;
            
            try {
                console.log('[Magazine] Loading magazine releases...');
                
                // List of PDF files in the releases folder
                // Since we can't dynamically list files from a static folder in browser,
                // we'll try to load a manifest file or use a predefined list
                const releases = await fetchMagazineReleases();
                
                if (releases.length === 0) {
                    releasesGrid.innerHTML = `
                        <div class="empty-releases" style="grid-column: 1/-1;">
                            <div class="empty-releases-icon">üìö</div>
                            <h3 data-en="No Releases Yet" data-ar="ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿµÿØÿßÿ±ÿßÿ™ ÿ®ÿπÿØ">No Releases Yet</h3>
                            <p data-en="Check back soon for our magazine releases!" data-ar="ÿ™ÿ≠ŸÇŸÇ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ ŸÇÿ±Ÿäÿ®ÿßŸã ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿµÿØÿßÿ±ÿßÿ™ ŸÖÿ¨ŸÑÿ™ŸÜÿß!">Check back soon for our magazine releases!</p>
                        </div>
                    `;
                    console.log('[Magazine] No releases found');
                    return;
                }
                
                console.log(`[Magazine] Found ${releases.length} release(s)`);
                
                // Display releases
                releasesGrid.innerHTML = releases.map((release, index) => `
                    <div class="release-card reveal">
                        <div class="release-preview">
                            üìñ
                        </div>
                        <div class="release-info">
                            <h3 class="release-title">${release.title}</h3>
                            <div class="release-date">üìÖ ${release.date}</div>
                            <div class="release-actions">
                                <a href="#" onclick="openPDFViewer('${release.url}', '${release.title}'); return false;" class="release-btn btn-view">
                                    üëÅÔ∏è View
                                </a>
                                <a href="${release.url}" download class="release-btn btn-download">
                                    ‚¨áÔ∏è Download
                                </a>
                            </div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('[Magazine] Error loading releases:', error);
                releasesGrid.innerHTML = `
                    <div class="empty-releases" style="grid-column: 1/-1;">
                        <div class="empty-releases-icon">üìö</div>
                        <h3 data-en="No Releases Yet" data-ar="ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿµÿØÿßÿ±ÿßÿ™ ÿ®ÿπÿØ">No Releases Yet</h3>
                        <p data-en="Check back soon for our magazine releases!" data-ar="ÿ™ÿ≠ŸÇŸÇ ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ ŸÇÿ±Ÿäÿ®ÿßŸã ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ•ÿµÿØÿßÿ±ÿßÿ™ ŸÖÿ¨ŸÑÿ™ŸÜÿß!">Check back soon for our magazine releases!</p>
                    </div>
                `;
            }
        }
        
        // Fetch magazine releases
        async function fetchMagazineReleases() {
            // Try to fetch manifest file
            try {
                const response = await fetch(`${RELEASES_FOLDER}manifest.json`);
                if (response.ok) {
                    const data = await response.json();
                    return data.releases || [];
                }
            } catch (e) {
                console.log('[Magazine] No manifest file found, checking for individual files');
            }
            
            // If no manifest, try common filenames
            const commonFiles = [
                'issue-01.pdf',
                'issue-02.pdf',
                'issue-03.pdf',
                'volume-1-issue-1.pdf',
                'spring-2025.pdf',
                'fall-2024.pdf',
                'winter-2024.pdf'
            ];
            
            const releases = [];
            
            for (const filename of commonFiles) {
                try {
                    const url = `${RELEASES_FOLDER}${filename}`;
                    const response = await fetch(url, { method: 'HEAD' });
                    if (response.ok) {
                        // Extract title from filename
                        const title = filename
                            .replace('.pdf', '')
                            .split('-')
                            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                            .join(' ');
                        
                        releases.push({
                            title: title,
                            url: url,
                            date: 'Release Date',
                            filename: filename
                        });
                    }
                } catch (e) {
                    // File doesn't exist, continue
                }
            }
            
            return releases;
        }

        // Function to create article card HTML
        function createArticleCard(article, index, categoryOverride = null) {
            const dateInfo = dataLoader.formatDate(article.date);
            
            // Skip articles with invalid dates
            if (!dateInfo) {
                console.warn('[Magazine] Skipping article with invalid date:', article.title);
                return '';
            }
            
            const categories = ['Design', 'Sustainability', 'Technology', 'History', 'Inspiration', 'Community'];
            const category = categoryOverride || categories[index % categories.length];
            const icons = ['üìê', 'üåø', 'üíª', 'üèõÔ∏è', 'üé®', 'üë•'];
            const icon = icons[index % icons.length];
            
            return `
                <div class="article-card reveal">
                    <div class="article-image" style="${article.imageUrl ? `background-image: url('${article.imageUrl}'); background-size: cover; background-position: center;` : ''}">
                        ${article.imageUrl ? '' : icon}
                        <span class="article-category">${category}</span>
                    </div>
                    <div class="article-content">
                        <div class="article-meta">
                            <span>üìÖ ${dateInfo.month} ${dateInfo.day}, ${dateInfo.year}</span>
                            <span>‚è±Ô∏è ${Math.floor(Math.random() * 5) + 3} min read</span>
                        </div>
                        <h3 class="article-title">${article.title}</h3>
                        <p class="article-excerpt">
                            ${article.summary}
                        </p>
                        ${article.readMoreUrl ? 
                            `<a href="${article.readMoreUrl}" class="read-more" target="_blank" rel="noopener noreferrer">Read More ‚Üí</a>` : 
                            `<a href="articles.html?id=${article.id}" class="read-more">Read More ‚Üí</a>`
                        }
                    </div>
                </div>
            `;
        }

        // Load magazine data from Firebase using Data Loader
        async function loadMagazine() {
            const featuredContent = document.getElementById('featuredContent');
            const latestArticles = document.getElementById('latestArticles');
            const designArticles = document.getElementById('designArticles');
            const communityArticles = document.getElementById('communityArticles');
            const allArticles = document.getElementById('allArticles');
            
            // Show loading state for all grids
            const loadingHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">‚è≥</div>
                    <p style="color: var(--text-secondary);">Loading articles...</p>
                </div>
            `;
            
            if (featuredContent) {
                featuredContent.innerHTML = loadingHTML;
            }
            [latestArticles, designArticles, communityArticles, allArticles].forEach(grid => {
                if (grid) grid.innerHTML = loadingHTML;
            });
            
            try {
                console.log('[Magazine] Loading magazine using Data Loader...');
                
                // Use Data Loader to fetch magazine
                const result = await dataLoader.getMagazine();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to load magazine');
                }
                
                const magazineData = result.magazine;
                const articlesCount = magazineData?.articles?.length || 0;
                const hasFeatured = !!magazineData?.featuredArticle;
                console.log(`[Magazine] ‚úì Magazine content loaded - Articles: ${articlesCount}, Has Featured: ${hasFeatured}`);
                
                // Always log fetched magazine data for debugging
                if (magazineData?.featuredArticle) {
                    console.log('[Magazine] Featured article:', {
                        title: magazineData.featuredArticle.title,
                        author: magazineData.featuredArticle.author,
                        date: magazineData.featuredArticle.date
                    });
                }
                if (articlesCount > 0) {
                    console.log('[Magazine] Article list:');
                    magazineData.articles.forEach((article, index) => {
                        console.log(`  Article ${index + 1}:`, {
                            id: article.id,
                            title: article.title,
                            author: article.author,
                            date: article.date
                        });
                    });
                }
                
                // Additional debug logging
                if (DEBUG) {
                    console.log('[Magazine] Debug mode enabled - Full magazine details');
                    if (magazineData?.featuredArticle) {
                        console.log('[Magazine] Featured article full data:', magazineData.featuredArticle);
                    }
                }
                
                if (magazineData) {
                    // Load featured article
                    if (magazineData.featuredArticle && featuredContent) {
                        const featured = magazineData.featuredArticle;
                        const dateInfo = dataLoader.formatDate(featured.date);
                        
                        // Only show if date is valid
                        if (dateInfo) {
                            featuredContent.innerHTML = `
                                <div class="featured-image reveal" style="${featured.imageUrl ? `background-image: url('${featured.imageUrl}'); background-size: cover; background-position: center;` : ''}">${featured.imageUrl ? '' : (featured.image || 'üèóÔ∏è')}</div>
                                <div class="featured-text reveal">
                                    <div class="article-date">üìÖ ${dateInfo.month} ${dateInfo.year}</div>
                                    <h2>${featured.title}</h2>
                                    <p>${featured.summary}</p>
                                    ${featured.content ? `<p>${featured.content.substring(0, 200)}...</p>` : ''}
                                    ${featured.readMoreUrl ? 
                                        `<a href="${featured.readMoreUrl}" class="btn btn-primary" target="_blank" rel="noopener noreferrer">Read Full Article</a>` : 
                                        `<a href="articles.html?id=${featured.id}" class="btn btn-primary">Read Full Article</a>`
                                    }
                                </div>
                            `;
                        } else {
                            console.warn('[Magazine] Featured article has invalid date');
                            featuredContent.innerHTML = `
                                <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                                    <div style="font-size: 4rem; margin-bottom: 1rem;">üì∞</div>
                                    <h3 style="color: var(--primary-color); margin-bottom: 0.5rem;">No Featured Article</h3>
                                    <p style="color: var(--text-secondary);">Check back soon for our featured content!</p>
                                </div>
                            `;
                        }
                    } else if (featuredContent) {
                        featuredContent.innerHTML = `
                            <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                                <div style="font-size: 4rem; margin-bottom: 1rem;">üì∞</div>
                                <h3 style="color: var(--primary-color); margin-bottom: 0.5rem;">No Featured Article</h3>
                                <p style="color: var(--text-secondary);">Check back soon for our featured content!</p>
                            </div>
                        `;
                    }
                    
                    // Process all articles
                    if (magazineData.articles && magazineData.articles.length > 0) {
                        const allArticlesList = [...magazineData.articles];
                        
                        // Latest Articles (first 3)
                        if (latestArticles) {
                            const latest = allArticlesList.slice(0, 3);
                            if (latest.length > 0) {
                                latestArticles.innerHTML = latest.map((article, index) => 
                                    createArticleCard(article, index)
                                ).join('');
                            } else {
                                latestArticles.innerHTML = `
                                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                                        <p style="color: var(--text-secondary);">No articles available yet</p>
                                    </div>
                                `;
                            }
                        }
                        
                        // Design Articles (articles 3-6 or with Design category)
                        if (designArticles) {
                            const design = allArticlesList.slice(3, 6);
                            if (design.length > 0) {
                                designArticles.innerHTML = design.map((article, index) => 
                                    createArticleCard(article, index, 'Design')
                                ).join('');
                            } else {
                                designArticles.innerHTML = `
                                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                                        <p style="color: var(--text-secondary);">No design articles available yet</p>
                                    </div>
                                `;
                            }
                        }
                        
                        // Community Articles (articles 6-9 or with Community category)
                        if (communityArticles) {
                            const community = allArticlesList.slice(6, 9);
                            if (community.length > 0) {
                                communityArticles.innerHTML = community.map((article, index) => 
                                    createArticleCard(article, index, 'Community')
                                ).join('');
                            } else {
                                communityArticles.innerHTML = `
                                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                                        <p style="color: var(--text-secondary);">No community articles available yet</p>
                                    </div>
                                `;
                            }
                        }
                        
                        // All Articles
                        if (allArticles) {
                            if (allArticlesList.length > 0) {
                                allArticles.innerHTML = allArticlesList.map((article, index) => 
                                    createArticleCard(article, index)
                                ).join('');
                            } else {
                                allArticles.innerHTML = `
                                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                                        <div style="font-size: 4rem; margin-bottom: 1rem;">üìÑ</div>
                                        <h3 style="color: var(--primary-color); margin-bottom: 0.5rem;">No Articles Available</h3>
                                        <p style="color: var(--text-secondary);">New articles coming soon!</p>
                                    </div>
                                `;
                            }
                        }
                    } else {
                        // Show empty state for all grids
                        const emptyHTML = `
                            <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                                <div style="font-size: 4rem; margin-bottom: 1rem;">üìÑ</div>
                                <h3 style="color: var(--primary-color); margin-bottom: 0.5rem;">No Articles Available</h3>
                                <p style="color: var(--text-secondary);">New articles coming soon!</p>
                            </div>
                        `;
                        [latestArticles, designArticles, communityArticles, allArticles].forEach(grid => {
                            if (grid) grid.innerHTML = emptyHTML;
                        });
                    }
                } else {
                    // Show empty state for all containers
                    const emptyHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">üì∞</div>
                            <h3 style="color: var(--primary-color); margin-bottom: 0.5rem;">No Content Available</h3>
                            <p style="color: var(--text-secondary);">Magazine content is being prepared. Check back soon!</p>
                        </div>
                    `;
                    if (featuredContent) featuredContent.innerHTML = emptyHTML;
                    [latestArticles, designArticles, communityArticles, allArticles].forEach(grid => {
                        if (grid) grid.innerHTML = emptyHTML;
                    });
                }
            } catch (error) {
                console.error('[Magazine] ‚úó Error loading magazine:', error);
                // Show error state
                const errorHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
                        <h3 style="color: var(--primary-color); margin-bottom: 0.5rem;">Unable to Load Articles</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">There was a problem loading the content. Please try again.</p>
                        <button class="btn btn-primary" onclick="location.reload()">Retry</button>
                    </div>
                `;
                if (featuredContent) featuredContent.innerHTML = errorHTML;
                [latestArticles, designArticles, communityArticles, allArticles].forEach(grid => {
                    if (grid) grid.innerHTML = errorHTML;
                });
            }
        }
        
        // Initialize view toggle functionality
        function initViewToggle() {
            const viewButtons = document.querySelectorAll('.view-btn');
            
            viewButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const viewType = this.getAttribute('data-view');
                    const targetId = this.getAttribute('data-target');
                    const targetGrid = document.getElementById(targetId);
                    
                    if (!targetGrid) return;
                    
                    // Remove all view classes
                    targetGrid.classList.remove('view-grid', 'view-list', 'view-compact', 'view-large');
                    
                    // Add selected view class
                    targetGrid.classList.add(`view-${viewType}`);
                    
                    // Update active state for buttons in this group
                    const siblingButtons = this.parentElement.querySelectorAll('.view-btn');
                    siblingButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Save preference to localStorage
                    localStorage.setItem(`view-${targetId}`, viewType);
                    
                    console.log(`[Magazine] View changed to ${viewType} for ${targetId}`);
                });
            });
            
            // Restore saved view preferences
            const grids = ['latestArticles', 'designArticles', 'communityArticles', 'allArticles'];
            grids.forEach(gridId => {
                const savedView = localStorage.getItem(`view-${gridId}`);
                if (savedView) {
                    const grid = document.getElementById(gridId);
                    const button = document.querySelector(`.view-btn[data-view="${savedView}"][data-target="${gridId}"]`);
                    
                    if (grid && button) {
                        grid.classList.remove('view-grid', 'view-list', 'view-compact', 'view-large');
                        grid.classList.add(`view-${savedView}`);
                        
                        const siblingButtons = button.parentElement.querySelectorAll('.view-btn');
                        siblingButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                    }
                }
            });
        }
        
        // Load magazine when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initPDFModal();
            loadMagazineReleases();
            loadMagazine();
            initViewToggle();
        });
    </script>
</body>
</html>
