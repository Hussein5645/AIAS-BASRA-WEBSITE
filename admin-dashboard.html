<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - AIAS Basra</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script type="module" src="js/firestore-api.js"></script>
    <script src="js/main.js" defer></script>
    <style>
        .admin-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem 0; margin-bottom: 2rem; }
        .admin-header .container { display: flex; justify-content: space-between; align-items: center; }
        .admin-header h1 { font-size: 2rem; font-weight: 800; }
        .admin-info { display: flex; align-items: center; gap: 1rem; }
        .logout-btn { padding: 0.5rem 1.5rem; background: rgba(255,255,255,0.2); color: white; border: 2px solid white; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all .3s; }
        .logout-btn:hover { background: white; color: #667eea; }
        .dashboard-nav { margin-bottom: 2rem; }
        .dashboard-nav ul { display: flex; gap: 1rem; list-style: none; padding: 0; border-bottom: 2px solid #e2e8f0; }
        .dashboard-nav li button { padding: 1rem 2rem; background: none; border: none; cursor: pointer; font-size: 1rem; font-weight: 600; color: #718096; transition: all .3s; position: relative; }
        .dashboard-nav li button.active { color: #667eea; }
        .dashboard-nav li button.active::after { content: ''; position: absolute; bottom: -2px; left: 0; right: 0; height: 2px; background: #667eea; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .content-form { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; color: #4a5568; font-size: .9rem; font-weight: 600; margin-bottom: .5rem; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: .75rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; font-family: 'Inter', sans-serif; transition: all .3s; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }
        .form-group textarea { min-height: 120px; resize: vertical; }
        .submit-btn { padding: 1rem 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all .3s; }
        .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102,126,234,0.3); }
        .message { padding: 1rem; border-radius: 8px; margin-bottom: 1rem; display: none; }
        .message.success { background: #f0fff4; color: #38a169; border-left: 4px solid #38a169; }
        .message.error { background: #fff5f5; color: #e53e3e; border-left: 4px solid #e53e3e; }
        .content-list { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .content-item { padding: 1rem; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; gap: 1rem; }
        .content-item:last-child { border-bottom: none; }
        .btn { padding: .5rem 1rem; border: none; border-radius: 6px; color: white; font-weight: 600; cursor: pointer; transition: all .2s; }
        .delete-btn { background: #e53e3e; } .delete-btn:hover { background: #c53030; }
        .edit-btn { background: #3182ce; } .edit-btn:hover { background: #2b6cb0; }
        .user-actions { display: flex; gap: .5rem; }
        .home-link { padding: .5rem 1.5rem; background: white; color: #667eea; border: 2px solid white; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all .3s; }
        .home-link:hover { background: rgba(255,255,255,0.9); }
    </style>
</head>
<body>
    <!-- Admin Header -->
    <div class="admin-header">
        <div class="container">
            <h1 data-en="Admin Dashboard" data-ar="ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿ•ÿØÿßÿ±Ÿäÿ©">Admin Dashboard</h1>
            <div class="admin-info">
                <button class="language-toggle" id="languageToggle" style="margin-right: 1rem; padding: 0.5rem 1rem; background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid white; border-radius: 8px; display: inline-flex; align-items: center; gap:.5rem;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                    </svg>
                    <span id="currentLang">EN</span>
                </button>
                <span id="adminName"></span>
                <a href="index.html" class="home-link" data-en="View Site" data-ar="ÿπÿ±ÿ∂ ÿßŸÑŸÖŸàŸÇÿπ">View Site</a>
                <button class="logout-btn" onclick="logout()" data-en="Logout" data-ar="ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨">Logout</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <div id="message" class="message"></div>

        <!-- Dashboard Navigation -->
        <nav class="dashboard-nav">
            <ul>
                <li><button onclick="showTab('events')" data-en="Events" data-ar="ÿßŸÑŸÅÿπÿßŸÑŸäÿßÿ™">Events</button></li>
                <li><button onclick="showTab('articles')" data-en="Magazine Articles" data-ar="ŸÖŸÇÿßŸÑÿßÿ™ ÿßŸÑŸÖÿ¨ŸÑÿ©">Magazine Articles</button></li>
                <li><button onclick="showTab('library')" data-en="Library Resources" data-ar="ŸÖŸàÿßÿ±ÿØ ÿßŸÑŸÖŸÉÿ™ÿ®ÿ©">Library Resources</button></li>
                <li><button onclick="showTab('education')" data-en="Education Content" data-ar="ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ™ÿπŸÑŸäŸÖŸä">Education Content</button></li>
                <li><button onclick="showTab('settings')" data-en="‚öôÔ∏è Settings" data-ar="‚öôÔ∏è ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™">‚öôÔ∏è Settings</button></li>
            </ul>
        </nav>

        <!-- Events Tab -->
        <div id="events-tab" class="tab-content">
            <h2 data-en="Manage Events" data-ar="ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÅÿπÿßŸÑŸäÿßÿ™">Manage Events</h2>
            <div class="content-list" style="margin-bottom: 2rem;">
                <h3 data-en="Existing Events" data-ar="ÿßŸÑŸÅÿπÿßŸÑŸäÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ©">Existing Events</h3>
                <div id="existingEventsList">
                    <p data-en="Loading events..." data-ar="ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÅÿπÿßŸÑŸäÿßÿ™...">Loading events...</p>
                </div>
            </div>

            <h2 data-en="Add New Event" data-ar="ÿ•ÿ∂ÿßŸÅÿ© ŸÅÿπÿßŸÑŸäÿ© ÿ¨ÿØŸäÿØÿ©">Add New Event</h2>
            <form id="eventForm" class="content-form" data-mode="add">
                <input type="hidden" id="eventId">
                <div class="form-group">
                    <label for="eventTitle" data-en="Event Title" data-ar="ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÅÿπÿßŸÑŸäÿ©">Event Title</label>
                    <input type="text" id="eventTitle" required>
                </div>
                <div class="form-group">
                    <label for="eventTime" data-en="Date and Time" data-ar="ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸàÿßŸÑŸàŸÇÿ™">Date and Time</label>
                    <input type="datetime-local" id="eventTime" required>
                </div>
                <div class="form-group">
                    <label for="eventLocation" data-en="Location" data-ar="ÿßŸÑŸÖŸàŸÇÿπ">Location</label>
                    <input type="text" id="eventLocation" required>
                </div>
                <div class="form-group">
                    <label for="eventType" data-en="Event Type" data-ar="ŸÜŸàÿπ ÿßŸÑŸÅÿπÿßŸÑŸäÿ©">Event Type</label>
                    <select id="eventType" required>
                        <option value="Workshop" data-en="Workshop" data-ar="Ÿàÿ±ÿ¥ÿ© ÿπŸÖŸÑ">Workshop</option>
                        <option value="Lecture" data-en="Lecture" data-ar="ŸÖÿ≠ÿßÿ∂ÿ±ÿ©">Lecture</option>
                        <option value="Social" data-en="Social" data-ar="ÿßÿ¨ÿ™ŸÖÿßÿπŸä">Social</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="eventSeats" data-en="Available Seats" data-ar="ÿßŸÑŸÖŸÇÿßÿπÿØ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©">Available Seats</label>
                    <input type="number" id="eventSeats" required min="0">
                </div>
                <div class="form-group">
                    <label for="eventImage" data-en="Emoji Icon" data-ar="ÿ£ŸäŸÇŸàŸÜÿ© ÿ•ŸäŸÖŸàÿ¨Ÿä">Emoji Icon</label>
                    <input type="text" id="eventImage" placeholder="üé®" required>
                </div>
                <div class="form-group">
                    <label for="eventDescription" data-en="Description" data-ar="ÿßŸÑŸàÿµŸÅ">Description</label>
                    <textarea id="eventDescription" required></textarea>
                </div>
                <button type="submit" id="eventSubmitBtn" class="submit-btn" data-en="Add Event" data-ar="ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÅÿπÿßŸÑŸäÿ©">Add Event</button>
            </form>
        </div>

        <!-- Articles Tab -->
        <div id="articles-tab" class="tab-content">
            <h2 data-en="Manage Magazine Articles" data-ar="ÿ•ÿØÿßÿ±ÿ© ŸÖŸÇÿßŸÑÿßÿ™ ÿßŸÑŸÖÿ¨ŸÑÿ©">Manage Magazine Articles</h2>
            <div class="content-list" style="margin-bottom: 2rem;">
                <h3 data-en="Existing Articles" data-ar="ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ©">Existing Articles</h3>
                <div id="existingArticlesList">
                    <p data-en="Loading articles..." data-ar="ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™...">Loading articles...</p>
                </div>
            </div>

            <h2 data-en="Add New Article" data-ar="ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÇÿßŸÑ ÿ¨ÿØŸäÿØ">Add New Article</h2>
            <form id="articleForm" class="content-form" data-mode="add">
                <input type="hidden" id="articleId">
                <div class="form-group">
                    <label for="articleTitle" data-en="Article Title" data-ar="ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÖŸÇÿßŸÑ">Article Title</label>
                    <input type="text" id="articleTitle" required>
                </div>
                <div class="form-group">
                    <label for="articleAuthor" data-en="Author Name" data-ar="ÿßÿ≥ŸÖ ÿßŸÑŸÉÿßÿ™ÿ®">Author Name</label>
                    <input type="text" id="articleAuthor" required>
                </div>
                <div class="form-group">
                    <label for="articleDate" data-en="Publication Date" data-ar="ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÜÿ¥ÿ±">Publication Date</label>
                    <input type="date" id="articleDate" required>
                </div>
                <div class="form-group">
                    <label for="articleSummary" data-en="Summary" data-ar="ÿßŸÑŸÖŸÑÿÆÿµ">Summary</label>
                    <textarea id="articleSummary" required></textarea>
                </div>
                <div class="form-group">
                    <label for="articleContent" data-en="Full Content" data-ar="ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÉÿßŸÖŸÑ">Full Content</label>
                    <textarea id="articleContent" required></textarea>
                </div>
                <button type="submit" id="articleSubmitBtn" class="submit-btn" data-en="Add Article" data-ar="ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸÇÿßŸÑ">Add Article</button>
            </form>
        </div>

        <!-- Library Tab -->
        <div id="library-tab" class="tab-content">
            <h2 data-en="Manage Library Resources" data-ar="ÿ•ÿØÿßÿ±ÿ© ŸÖŸàÿßÿ±ÿØ ÿßŸÑŸÖŸÉÿ™ÿ®ÿ©">Manage Library Resources</h2>
            <div class="content-list" style="margin-bottom: 2rem;">
                <h3 data-en="Existing Resources" data-ar="ÿßŸÑŸÖŸàÿßÿ±ÿØ ÿßŸÑÿ≠ÿßŸÑŸäÿ©">Existing Resources</h3>
                <div id="existingLibraryList">
                    <p data-en="Loading resources..." data-ar="ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸàÿßÿ±ÿØ...">Loading resources...</p>
                </div>
            </div>

            <h2 data-en="Add New Library Resource" data-ar="ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸàÿ±ÿØ ŸÖŸÉÿ™ÿ®Ÿä ÿ¨ÿØŸäÿØ">Add New Library Resource</h2>
            <form id="libraryForm" class="content-form" data-mode="add">
                <input type="hidden" id="libId">
                <div class="form-group">
                    <label for="libName" data-en="Resource Name" data-ar="ÿßÿ≥ŸÖ ÿßŸÑŸÖŸàÿ±ÿØ">Resource Name</label>
                    <input type="text" id="libName" required>
                </div>
                <div class="form-group">
                    <label for="libType" data-en="Type" data-ar="ÿßŸÑŸÜŸàÿπ">Type</label>
                    <select id="libType" required>
                        <option value="Book" data-en="Book" data-ar="ŸÉÿ™ÿßÿ®">Book</option>
                        <option value="Tutorial" data-en="Tutorial" data-ar="ÿØÿ±ÿ≥ ÿ™ÿπŸÑŸäŸÖŸä">Tutorial</option>
                        <option value="Software" data-en="Software" data-ar="ÿ®ÿ±ŸÜÿßŸÖÿ¨">Software</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="libTags" data-en="Tags (comma-separated)" data-ar="ÿßŸÑŸàÿ≥ŸàŸÖ (ŸÖŸÅÿµŸàŸÑÿ© ÿ®ŸÅÿßÿµŸÑÿ©)">Tags (comma-separated)</label>
                    <input type="text" id="libTags" placeholder="Design, Fundamentals, Theory" required>
                </div>
                <div class="form-group">
                    <label for="libImage" data-en="Emoji Icon" data-ar="ÿ£ŸäŸÇŸàŸÜÿ© ÿ•ŸäŸÖŸàÿ¨Ÿä">Emoji Icon</label>
                    <input type="text" id="libImage" placeholder="üìö" required>
                </div>
                <div class="form-group">
                    <label for="libDescription" data-en="Description" data-ar="ÿßŸÑŸàÿµŸÅ">Description</label>
                    <textarea id="libDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label for="libLink" data-en="Download Link" data-ar="ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ">Download Link</label>
                    <input type="url" id="libLink" placeholder="https://" required>
                </div>
                <button type="submit" id="libSubmitBtn" class="submit-btn" data-en="Add Resource" data-ar="ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖŸàÿ±ÿØ">Add Resource</button>
            </form>
        </div>

        <!-- Education Tab -->
        <div id="education-tab" class="tab-content">
            <h2 data-en="Education Management" data-ar="ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ™ÿπŸÑŸäŸÖ">Education Management</h2>

            <!-- Weekly Workshop (Edit only) -->
            <div class="content-form">
                <h3 data-en="Weekly Workshop (Edit Only)" data-ar="Ÿàÿ±ÿ¥ÿ© ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ (ÿ™ÿπÿØŸäŸÑ ŸÅŸÇÿ∑)">Weekly Workshop (Edit Only)</h3>
                <form id="educationForm">
                    <div class="form-group">
                        <label for="weekTitle" data-en="Weekly Workshop Title" data-ar="ÿπŸÜŸàÿßŸÜ Ÿàÿ±ÿ¥ÿ© ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ">Weekly Workshop Title</label>
                        <input type="text" id="weekTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="lecturerName" data-en="Lecturer Name" data-ar="ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≠ÿßÿ∂ÿ±">Lecturer Name</label>
                        <input type="text" id="lecturerName" required>
                    </div>
                    <div class="form-group">
                        <label for="weekDescription" data-en="Workshop Description" data-ar="ŸàÿµŸÅ ÿßŸÑŸàÿ±ÿ¥ÿ©">Workshop Description</label>
                        <textarea id="weekDescription" required></textarea>
                    </div>
                    <button type="submit" class="submit-btn" data-en="Update Weekly Workshop" data-ar="ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿ±ÿ¥ÿ© ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ">Update Weekly Workshop</button>
                </form>
            </div>

            <!-- Courses CRUD -->
            <div class="content-form">
                <h3 data-en="Courses" data-ar="ÿßŸÑÿØŸàÿ±ÿßÿ™">Courses</h3>

                <div class="content-list" style="margin-bottom: 1.5rem;">
                    <h4 data-en="Existing Courses" data-ar="ÿßŸÑÿØŸàÿ±ÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ©">Existing Courses</h4>
                    <div id="existingCoursesList"><p data-en="Loading courses..." data-ar="ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿØŸàÿ±ÿßÿ™...">Loading courses...</p></div>
                </div>

                <h4 data-en="Add or Edit Course" data-ar="ÿ•ÿ∂ÿßŸÅÿ© ÿ£Ÿà ÿ™ÿπÿØŸäŸÑ ÿØŸàÿ±ÿ©">Add or Edit Course</h4>
                <form id="courseForm" data-mode="add">
                    <input type="hidden" id="courseId">
                    <div class="form-group">
                        <label for="courseTitle" data-en="Course Title" data-ar="ÿπŸÜŸàÿßŸÜ ÿßŸÑÿØŸàÿ±ÿ©">Course Title</label>
                        <input type="text" id="courseTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="courseDescription" data-en="Course Description" data-ar="ŸàÿµŸÅ ÿßŸÑÿØŸàÿ±ÿ©">Course Description</label>
                        <textarea id="courseDescription" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="courseLecturer" data-en="Lecturer (optional)" data-ar="ÿßŸÑŸÖÿ≠ÿßÿ∂ÿ± (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)">Lecturer (optional)</label>
                        <input type="text" id="courseLecturer">
                    </div>
                    <div class="form-group">
                        <label for="courseLink" data-en="Link (optional)" data-ar="ÿßŸÑÿ±ÿßÿ®ÿ∑ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)">Link (optional)</label>
                        <input type="url" id="courseLink" placeholder="https://">
                    </div>
                    <button type="submit" id="courseSubmitBtn" class="submit-btn" data-en="Add Course" data-ar="ÿ•ÿ∂ÿßŸÅÿ© ÿØŸàÿ±ÿ©">Add Course</button>
                </form>
            </div>

            <!-- FBD Management -->
            <div class="content-form">
                <h3 data-en="FBD Page" data-ar="ÿµŸÅÿ≠ÿ© FBD">FBD Page</h3>
                <form id="fbdPageForm">
                    <div class="form-group">
                        <label for="fbdTitle" data-en="Page Title" data-ar="ÿπŸÜŸàÿßŸÜ ÿßŸÑÿµŸÅÿ≠ÿ©">Page Title</label>
                        <input type="text" id="fbdTitle" placeholder="FBD">
                    </div>
                    <div class="form-group">
                        <label for="fbdAbout" data-en="About" data-ar="ÿ≠ŸàŸÑ">About</label>
                        <textarea id="fbdAbout" placeholder="About FBD..."></textarea>
                    </div>
                    <button type="submit" class="submit-btn" data-en="Update FBD Page" data-ar="ÿ™ÿ≠ÿØŸäÿ´ ÿµŸÅÿ≠ÿ© FBD">Update FBD Page</button>
                </form>
            </div>

            <div class="content-form">
                <h3 data-en="FBD Events" data-ar="ŸÅÿπÿßŸÑŸäÿßÿ™ FBD">FBD Events</h3>

                <div class="content-list" style="margin-bottom: 1.5rem;">
                    <h4 data-en="Existing FBD Events" data-ar="ÿßŸÑŸÅÿπÿßŸÑŸäÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ©">Existing FBD Events</h4>
                    <div id="existingFbdEventsList"><p data-en="Loading FBD events..." data-ar="ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ŸÅÿπÿßŸÑŸäÿßÿ™ FBD...">Loading FBD events...</p></div>
                </div>

                <h4 data-en="Add or Edit FBD Event" data-ar="ÿ•ÿ∂ÿßŸÅÿ© ÿ£Ÿà ÿ™ÿπÿØŸäŸÑ ŸÅÿπÿßŸÑŸäÿ© FBD">Add or Edit FBD Event</h4>
                <form id="fbdEventForm" data-mode="add">
                    <input type="hidden" id="fbdEventId">
                    <div class="form-group">
                        <label for="fbdEventTitle" data-en="Event Title" data-ar="ÿπŸÜŸàÿßŸÜ ÿßŸÑŸÅÿπÿßŸÑŸäÿ©">Event Title</label>
                        <input type="text" id="fbdEventTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="fbdEventTime" data-en="Date and Time" data-ar="ÿßŸÑÿ™ÿßÿ±ŸäÿÆ ŸàÿßŸÑŸàŸÇÿ™">Date and Time</label>
                        <input type="datetime-local" id="fbdEventTime" required>
                    </div>
                    <div class="form-group">
                        <label for="fbdEventLocation" data-en="Location" data-ar="ÿßŸÑŸÖŸàŸÇÿπ">Location</label>
                        <input type="text" id="fbdEventLocation" required>
                    </div>
                    <div class="form-group">
                        <label for="fbdEventType" data-en="Event Type" data-ar="ŸÜŸàÿπ ÿßŸÑŸÅÿπÿßŸÑŸäÿ©">Event Type</label>
                        <select id="fbdEventType">
                            <option value="Workshop" data-en="Workshop" data-ar="Ÿàÿ±ÿ¥ÿ© ÿπŸÖŸÑ">Workshop</option>
                            <option value="Lecture" data-en="Lecture" data-ar="ŸÖÿ≠ÿßÿ∂ÿ±ÿ©">Lecture</option>
                            <option value="Social" data-en="Social" data-ar="ÿßÿ¨ÿ™ŸÖÿßÿπŸä">Social</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fbdEventSeats" data-en="Available Seats" data-ar="ÿßŸÑŸÖŸÇÿßÿπÿØ ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©">Available Seats</label>
                        <input type="number" id="fbdEventSeats" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="fbdEventImage" data-en="Emoji Icon" data-ar="ÿ£ŸäŸÇŸàŸÜÿ© ÿ•ŸäŸÖŸàÿ¨Ÿä">Emoji Icon</label>
                        <input type="text" id="fbdEventImage" placeholder="üé®">
                    </div>
                    <div class="form-group">
                        <label for="fbdEventDescription" data-en="Description" data-ar="ÿßŸÑŸàÿµŸÅ">Description</label>
                        <textarea id="fbdEventDescription" required></textarea>
                    </div>
                    <button type="submit" id="fbdEventSubmitBtn" class="submit-btn" data-en="Add FBD Event" data-ar="ÿ•ÿ∂ÿßŸÅÿ© ŸÅÿπÿßŸÑŸäÿ© FBD">Add FBD Event</button>
                </form>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-tab" class="tab-content">
            <h2 data-en="Firestore Settings" data-ar="ÿ•ÿπÿØÿßÿØÿßÿ™ Firestore">Firestore Settings</h2>
            <div class="content-form">
                <div id="tokenStatus" style="padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <p style="margin: 0;"><strong data-en="Status:" data-ar="ÿßŸÑÿ≠ÿßŸÑÿ©:">Status:</strong> <span id="tokenStatusText" data-en="Checking..." data-ar="ÿ¨ÿßÿ±Ÿä ÿßŸÑŸÅÿ≠ÿµ...">Checking...</span></p>
                </div>
                <p style="color:#4a5568; margin-bottom: 1.5rem;" data-en="Content is now stored in Firebase Firestore. No additional configuration needed." data-ar="Ÿäÿ™ŸÖ ÿßŸÑÿ¢ŸÜ ÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ŸÅŸä Firebase Firestore. ŸÑÿß ÿ≠ÿßÿ¨ÿ© ŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©.">
                    Content is now stored in Firebase Firestore. No additional configuration needed.
                </p>
                <button type="button" class="submit-btn" onclick="testFirestoreConnection()" style="background:#38a169;" data-en="Test Connection" data-ar="ÿßÿÆÿ™ÿ®ÿßÿ± ÿßŸÑÿßÿ™ÿµÿßŸÑ">Test Connection</button>
            </div>

            <div class="content-form" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1rem; color: #2d3748;" data-en="Firestore Structure Management" data-ar="ÿ•ÿØÿßÿ±ÿ© ÿ®ŸÜŸäÿ© Firestore">Firestore Structure Management</h3>
                <p style="color:#4a5568; margin-bottom: 1.5rem;" data-en="Validate and fix the Firestore database structure. This will check for missing collections, documents, and fields, and repair them automatically." data-ar="ÿ™ÿ≠ŸÇŸÇ Ÿàÿ£ÿµŸÑÿ≠ ÿ®ŸÜŸäÿ© ŸÇÿßÿπÿØÿ© ÿ®ŸäÿßŸÜÿßÿ™ Firestore. ÿ≥Ÿäÿ™ŸÖ ŸÅÿ≠ÿµ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™ ŸàÿßŸÑŸÖÿ≥ÿ™ŸÜÿØÿßÿ™ ŸàÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖŸÅŸÇŸàÿØÿ© Ÿàÿ•ÿµŸÑÿßÿ≠Ÿáÿß ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß.">
                    Validate and fix the Firestore database structure. This will check for missing collections, documents, and fields, and repair them automatically.
                </p>
                <div id="structureResults" style="display: none; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem; max-height: 300px; overflow-y: auto;">
                    <h4 style="margin-top: 0;" data-en="Structure Validation Results:" data-ar="ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿ®ŸÜŸäÿ©:">Structure Validation Results:</h4>
                    <div id="structureResultsContent"></div>
                </div>
                <button type="button" class="submit-btn" onclick="fixFirestoreStructure()" style="background:#667eea;" data-en="Fix Firestore Structure" data-ar="ÿ•ÿµŸÑÿßÿ≠ ÿ®ŸÜŸäÿ© Firestore">Fix Firestore Structure</button>
            </div>

            <div class="content-form" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1rem; color: #2d3748;" data-en="Admin Management" data-ar="ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ">Admin Management</h3>
                <p style="color:#4a5568; margin-bottom: 1.5rem;" data-en="Add or remove admin users by email. Admins have full access to the dashboard and can manage content." data-ar="ÿ£ÿ∂ŸÅ ÿ£Ÿà ÿßÿ≠ÿ∞ŸÅ ŸÖÿ≥ÿ§ŸàŸÑÿß ÿ®ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä. ŸÑÿØŸâ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸäŸÜ ŸàÿµŸàŸÑ ŸÉÿßŸÖŸÑ ŸÑŸÑŸàÿ≠ÿ© ŸàŸäŸÖŸÉŸÜŸáŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ.">
                    Add or remove admin users by email. Admins have full access to the dashboard and can manage content.
                </p>
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color:#2d3748; margin-bottom: .5rem;" data-en="Current Admins:" data-ar="ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑŸàŸÜ ÿßŸÑÿ≠ÿßŸÑŸäŸàŸÜ:">Current Admins:</h4>
                    <div id="adminsList" style="background:#f7fafc; padding: 1rem; border-radius: 8px; min-height: 60px;">
                        <p data-en="Loading..." data-ar="ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...">Loading...</p>
                    </div>
                </div>
                <div class="form-group">
                    <label for="newAdminEmail" data-en="Add Admin Email" data-ar="ÿ•ÿ∂ÿßŸÅÿ© ÿ®ÿ±ŸäÿØ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ŸÑŸÑŸÖÿ≥ÿ§ŸàŸÑ">Add Admin Email</label>
                    <div style="display:flex; gap:1rem;">
                        <input type="email" id="newAdminEmail" placeholder="admin@example.com" style="flex:1;">
                        <button type="button" class="submit-btn" onclick="addNewAdmin()" style="flex-shrink:0;" data-en="Add Admin" data-ar="ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ§ŸàŸÑ">Add Admin</button>
                    </div>
                </div>
            </div>

            <div style="margin-top: 2rem; padding: 1.5rem; background: #f7fafc; border-radius: 12px;">
                <h3 style="margin-bottom: 1rem; color: #2d3748;" data-en="About Firestore Integration:" data-ar="ÿ≠ŸàŸÑ ÿßŸÑÿ™ŸÉÿßŸÖŸÑ ŸÖÿπ Firestore:">About Firestore Integration:</h3>
                <ul style="color:#4a5568; line-height: 1.8;">
                    <li data-en="Content is automatically synchronized across all users" data-ar="Ÿäÿ™ŸÖ ŸÖÿ≤ÿßŸÖŸÜÿ© ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿ®ŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ">Content is automatically synchronized across all users</li>
                    <li data-en="Changes are saved instantly to the cloud" data-ar="Ÿäÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ŸÅŸàÿ±ÿßŸã ŸÅŸä ÿßŸÑÿ≥ÿ≠ÿßÿ®ÿ©">Changes are saved instantly to the cloud</li>
                    <li data-en="No GitHub tokens required - authentication handled by Firebase" data-ar="ŸÑÿß ÿ≠ÿßÿ¨ÿ© ŸÑÿ±ŸÖŸàÿ≤ GitHub - ÿßŸÑŸÖÿµÿßÿØŸÇÿ© ÿ™ÿ™ŸÖ ÿπÿ®ÿ± Firebase">No GitHub tokens required - authentication handled by Firebase</li>
                    <li data-en="Enhanced security with Firestore security rules" data-ar="ÿ£ŸÖÿßŸÜ ŸÖÿ≠ÿ≥ŸëŸÜ ŸÖÿπ ŸÇŸàÿßÿπÿØ ÿ£ŸÖÿßŸÜ Firestore">Enhanced security with Firestore security rules</li>
                    <li data-en="Better performance with automatic caching" data-ar="ÿ£ÿØÿßÿ° ÿ£ŸÅÿ∂ŸÑ ŸÖÿπ ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä">Better performance with automatic caching</li>
                </ul>
                <p style="color:#38a169; margin-top: 1rem; font-weight: 600;" data-en="‚úì All your changes are saved securely in Firebase Firestore" data-ar="‚úì Ÿäÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ¨ŸÖŸäÿπ ÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ŸÉ ÿ®ÿ£ŸÖÿßŸÜ ŸÅŸä Firebase Firestore">‚úì All your changes are saved securely in Firebase Firestore</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp, getApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import FirestoreAPI from "./js/firestore-api.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAyLFqSWDyLShllJIoqsr2Jjme47OJTPKQ",
            authDomain: "aias-bsr.firebaseapp.com",
            projectId: "aias-bsr",
            storageBucket: "aias-bsr.firebasestorage.app",
            messagingSenderId: "78055223814",
            appId: "1:78055223814:web:99460402c2b1fcd5ae8987",
            measurementId: "G-6W50T4HXDV"
        };

        let app;
        try { app = getApp(); } catch (e) { app = initializeApp(firebaseConfig); }
        const auth = getAuth(app);
        const db = getFirestore(app);

        const firestoreAPI = new FirestoreAPI();

        // Caches for edit flows
        let CACHE = { events: [], articles: [], library: [], courses: [], fbdEvents: [] };

        window.logout = async function() {
            try {
                await signOut(auth);
                localStorage.removeItem('aias_authenticated');
                localStorage.removeItem('aias_user_email');
                localStorage.removeItem('aias_user_name');
                localStorage.removeItem('aias_user_picture');
                localStorage.removeItem('aias_is_admin');
                localStorage.removeItem('aias_user_uid');
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Logout error:', error);
                alert('Error signing out. Please try again.');
            }
        };

        async function checkIfAdmin(email) {
            try {
                const adminDoc = await getDoc(doc(db, 'config', 'admins'));
                if (adminDoc.exists()) {
                    const data = adminDoc.data();
                    return data.admins && data.admins.includes(email.toLowerCase());
                }
                return false;
            } catch (error) {
                console.error('Error checking admin status:', error);
                return false;
            }
        }

        (function() {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    const isAdmin = await checkIfAdmin(user.email);
                    if (!isAdmin) {
                        alert('Access denied. Admin privileges required.');
                        window.location.href = 'login.html';
                        return;
                    }
                    localStorage.setItem('aias_authenticated', 'true');
                    localStorage.setItem('aias_user_email', user.email);
                    localStorage.setItem('aias_user_name', user.displayName || 'Admin');
                    localStorage.setItem('aias_user_picture', user.photoURL || '');
                    localStorage.setItem('aias_is_admin', 'true');
                    localStorage.setItem('aias_user_uid', user.uid);
                    document.getElementById('adminName').textContent = user.displayName || 'Admin';

                    // Default: open Education and load everything
                    showTab('education');
                } else {
                    window.location.href = 'login.html';
                }
            });
        })();

        // Helper: reapply translations
        window.reapplyTranslations = function() {
            if (typeof setLanguage === 'function') {
                const currentLang = localStorage.getItem('language') || 'en';
                setLanguage(currentLang);
            }
        };

        // Messages
        window.showMessage = function(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            setTimeout(() => { messageDiv.style.display = 'none'; }, 5000);
        };

        // Tabs
        window.showTab = function(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.dashboard-nav button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
            event?.target?.classList?.add('active');

            if (tabName === 'events') loadExistingEvents();
            else if (tabName === 'articles') loadExistingArticles();
            else if (tabName === 'library') loadExistingLibraryResources();
            else if (tabName === 'education') {
                loadEducationContent();
                loadCourses();
                loadFbd();
            }
            else if (tabName === 'settings') {
                updateTokenStatus();
                loadAdminsList?.();
            }
        };

        // Events
        window.loadExistingEvents = async function() {
            const listContainer = document.getElementById('existingEventsList');
            listContainer.innerHTML = '<p>Loading events...</p>';
            try {
                const res = await firestoreAPI.getAllContent();
                if (!res.success) throw new Error(res.error || 'Failed to read events');
                const events = res.content.events || [];
                CACHE.events = events;
                if (events.length === 0) {
                    listContainer.innerHTML = '<p>No events found.</p>';
                    return;
                }
                let html = '';
                events.forEach(ev => {
                    html += `
                        <div class="content-item">
                            <div>
                                <strong>${ev.title}</strong><br>
                                <small>${new Date(ev.time).toLocaleString()} - ${ev.location}</small>
                            </div>
                            <div class="user-actions">
                                <button class="btn edit-btn" onclick="editEvent('${ev.id}')">Edit</button>
                                <button class="btn delete-btn" onclick="deleteEvent('${ev.id}')">Delete</button>
                            </div>
                        </div>
                    `;
                });
                listContainer.innerHTML = html;
                reapplyTranslations();
            } catch (e) {
                console.error(e);
                listContainer.innerHTML = '<p style="color:red;">Error loading events</p>';
            }
        };
        window.editEvent = function(id) {
            const ev = CACHE.events.find(e => e.id === id);
            if (!ev) return;
            document.getElementById('eventId').value = ev.id;
            document.getElementById('eventTitle').value = ev.title || '';
            document.getElementById('eventTime').value = ev.time ? new Date(ev.time).toISOString().slice(0,16) : '';
            document.getElementById('eventLocation').value = ev.location || '';
            document.getElementById('eventType').value = ev.type || 'Workshop';
            document.getElementById('eventSeats').value = ev.seats ?? 0;
            document.getElementById('eventImage').value = ev.image || '';
            document.getElementById('eventDescription').value = ev.description || '';
            const form = document.getElementById('eventForm');
            form.dataset.mode = 'edit';
            document.getElementById('eventSubmitBtn').textContent = 'Update Event';
        };
        window.deleteEvent = async function(eventId) {
            const currentLang = localStorage.getItem('language') || 'en';
            const confirmMsg = currentLang === 'ar' ? 'ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑŸÅÿπÿßŸÑŸäÿ©ÿü' : 'Are you sure you want to delete this event?';
            if (!confirm(confirmMsg)) return;
            const r = await firestoreAPI.deleteEvent(eventId);
            if (r.success) { showMessage(currentLang === 'ar' ? 'ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÅÿπÿßŸÑŸäÿ© ÿ®ŸÜÿ¨ÿßÿ≠!' : 'Event deleted successfully!', 'success'); loadExistingEvents(); }
            else { showMessage((currentLang === 'ar' ? 'ŸÅÿ¥ŸÑ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÅÿπÿßŸÑŸäÿ©: ' : 'Failed to delete event: ') + r.error, 'error'); }
        };

        // Articles
        window.loadExistingArticles = async function() {
            const listContainer = document.getElementById('existingArticlesList');
            listContainer.innerHTML = '<p>Loading articles...</p>';
            try {
                const res = await firestoreAPI.getAllContent();
                if (!res.success) throw new Error(res.error || 'Failed to read articles');
                const articles = (res.content.magazine && res.content.magazine.articles) || [];
                CACHE.articles = articles;
                if (articles.length === 0) {
                    listContainer.innerHTML = '<p>No articles found.</p>';
                    return;
                }
                let html = '';
                articles.forEach(a => {
                    html += `
                        <div class="content-item">
                            <div>
                                <strong>${a.title}</strong><br>
                                <small>by ${a.author} - ${a.date}</small>
                            </div>
                            <div class="user-actions">
                                <button class="btn edit-btn" onclick="editArticle('${a.id}')">Edit</button>
                                <button class="btn delete-btn" onclick="deleteArticle('${a.id}')">Delete</button>
                            </div>
                        </div>
                    `;
                });
                listContainer.innerHTML = html;
                reapplyTranslations();
            } catch (e) {
                console.error(e);
                listContainer.innerHTML = '<p style="color:red;">Error loading articles</p>';
            }
        };
        window.editArticle = function(id) {
            const a = CACHE.articles.find(x => x.id === id);
            if (!a) return;
            document.getElementById('articleId').value = a.id;
            document.getElementById('articleTitle').value = a.title || '';
            document.getElementById('articleAuthor').value = a.author || '';
            document.getElementById('articleDate').value = a.date || '';
            document.getElementById('articleSummary').value = a.summary || '';
            document.getElementById('articleContent').value = a.content || '';
            document.getElementById('articleForm').dataset.mode = 'edit';
            document.getElementById('articleSubmitBtn').textContent = 'Update Article';
        };
        window.deleteArticle = async function(articleId) {
            const currentLang = localStorage.getItem('language') || 'en';
            const confirmMsg = currentLang === 'ar' ? 'ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÖŸÇÿßŸÑÿü' : 'Are you sure you want to delete this article?';
            if (!confirm(confirmMsg)) return;
            const r = await firestoreAPI.deleteArticle(articleId);
            if (r.success) { showMessage(currentLang === 'ar' ? 'ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÇÿßŸÑ ÿ®ŸÜÿ¨ÿßÿ≠!' : 'Article deleted successfully!', 'success'); loadExistingArticles(); }
            else { showMessage((currentLang === 'ar' ? 'ŸÅÿ¥ŸÑ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸÇÿßŸÑ: ' : 'Failed to delete article: ') + r.error, 'error'); }
        };

        // Library
        window.loadExistingLibraryResources = async function() {
            const listContainer = document.getElementById('existingLibraryList');
            listContainer.innerHTML = '<p>Loading resources...</p>';
            try {
                const res = await firestoreAPI.getAllContent();
                if (!res.success) throw new Error(res.error || 'Failed to read resources');
                const items = res.content.library || [];
                CACHE.library = items;
                if (items.length === 0) {
                    listContainer.innerHTML = '<p>No resources found.</p>';
                    return;
                }
                let html = '';
                items.forEach(r => {
                    const tags = Array.isArray(r.tags) ? r.tags.join(', ') : (r.tags || '');
                    html += `
                        <div class="content-item">
                            <div>
                                <strong>${r.name}</strong><br>
                                <small>${r.type} - ${tags}</small>
                            </div>
                            <div class="user-actions">
                                <button class="btn edit-btn" onclick="editLibrary('${r.id}')">Edit</button>
                                <button class="btn delete-btn" onclick="deleteLibraryResource('${r.id}')">Delete</button>
                            </div>
                        </div>
                    `;
                });
                listContainer.innerHTML = html;
                reapplyTranslations();
            } catch (e) {
                console.error(e);
                listContainer.innerHTML = '<p style="color:red;">Error loading resources</p>';
            }
        };
        window.editLibrary = function(id) {
            const r = CACHE.library.find(x => x.id === id);
            if (!r) return;
            document.getElementById('libId').value = r.id;
            document.getElementById('libName').value = r.name || '';
            document.getElementById('libType').value = r.type || 'Book';
            document.getElementById('libTags').value = Array.isArray(r.tags) ? r.tags.join(', ') : (r.tags || '');
            document.getElementById('libImage').value = r.image || '';
            document.getElementById('libDescription').value = r.description || '';
            document.getElementById('libLink').value = r.link || '';
            const form = document.getElementById('libraryForm');
            form.dataset.mode = 'edit';
            document.getElementById('libSubmitBtn').textContent = 'Update Resource';
        };
        window.deleteLibraryResource = async function(resourceId) {
            const currentLang = localStorage.getItem('language') || 'en';
            const confirmMsg = currentLang === 'ar' ? 'ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑŸÖŸàÿ±ÿØÿü' : 'Are you sure you want to delete this resource?';
            if (!confirm(confirmMsg)) return;
            const r = await firestoreAPI.deleteLibraryResource(resourceId);
            if (r.success) { showMessage(currentLang === 'ar' ? 'ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸàÿ±ÿØ ÿ®ŸÜÿ¨ÿßÿ≠!' : 'Resource deleted successfully!', 'success'); loadExistingLibraryResources(); }
            else { showMessage((currentLang === 'ar' ? 'ŸÅÿ¥ŸÑ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖŸàÿ±ÿØ: ' : 'Failed to delete resource: ') + r.error, 'error'); }
        };

        // Education base (weekly workshop only)
        window.loadEducationContent = async function() {
            try {
                const res = await firestoreAPI.getAllContent();
                if (res.success && res.content.education && res.content.education.weeklyWorkshop) {
                    const w = res.content.education.weeklyWorkshop;
                    document.getElementById('weekTitle').value = w.weekTitle || '';
                    document.getElementById('lecturerName').value = w.lecturerName || '';
                    document.getElementById('weekDescription').value = w.description || '';
                }
            } catch (error) {
                console.error('Error loading education:', error);
            }
        };

        // Courses CRUD
        window.loadCourses = async function() {
            const box = document.getElementById('existingCoursesList');
            box.innerHTML = '<p>Loading courses...</p>';
            try {
                const res = await firestoreAPI.getAllContent();
                if (!res.success) throw new Error(res.error);
                const courses = res.content.education?.courses || [];
                CACHE.courses = courses;
                if (courses.length === 0) {
                    box.innerHTML = '<p>No courses found.</p>';
                    return;
                }
                box.innerHTML = courses.map(c => `
                    <div class="content-item">
                        <div>
                            <strong>${c.title}</strong><br>
                            <small>${c.lecturer ? c.lecturer + ' ‚Äî ' : ''}${c.link ? `<a href="${c.link}" target="_blank">Link</a>` : ''}</small>
                        </div>
                        <div class="user-actions">
                            <button class="btn edit-btn" onclick="editCourse('${c.id}')">Edit</button>
                            <button class="btn delete-btn" onclick="deleteCourse('${c.id}')">Delete</button>
                        </div>
                    </div>
                `).join('');
            } catch (e) {
                console.error(e);
                box.innerHTML = '<p style="color:red;">Error loading courses</p>';
            }
        };
        window.editCourse = function(id) {
            const c = CACHE.courses.find(x => x.id === id);
            if (!c) return;
            document.getElementById('courseId').value = c.id;
            document.getElementById('courseTitle').value = c.title || '';
            document.getElementById('courseDescription').value = c.description || '';
            document.getElementById('courseLecturer').value = c.lecturer || '';
            document.getElementById('courseLink').value = c.link || '';
            const form = document.getElementById('courseForm');
            form.dataset.mode = 'edit';
            document.getElementById('courseSubmitBtn').textContent = 'Update Course';
        };
        window.deleteCourse = async function(id) {
            const confirmMsg = (localStorage.getItem('language') || 'en') === 'ar' ? 'ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑÿØŸàÿ±ÿ©ÿü' : 'Are you sure you want to delete this course?';
            if (!confirm(confirmMsg)) return;
            const r = await firestoreAPI.deleteCourse(id);
            if (r.success) { showMessage('Course deleted', 'success'); loadCourses(); }
            else { showMessage(r.error || 'Failed to delete course', 'error'); }
        };

        // FBD management
        window.loadFbd = async function() {
            const list = document.getElementById('existingFbdEventsList');
            list.innerHTML = '<p>Loading FBD events...</p>';
            try {
                const res = await firestoreAPI.getAllContent();
                if (!res.success) throw new Error(res.error);
                const fbd = res.content.education?.fbd || { pageTitle: '', about: '', events: [] };
                // Page
                document.getElementById('fbdTitle').value = fbd.pageTitle || '';
                document.getElementById('fbdAbout').value = fbd.about || '';
                // Events
                CACHE.fbdEvents = fbd.events || [];
                if (CACHE.fbdEvents.length === 0) {
                    list.innerHTML = '<p>No FBD events found.</p>';
                } else {
                    list.innerHTML = CACHE.fbdEvents.map(ev => `
                        <div class="content-item">
                            <div>
                                <strong>${ev.title}</strong><br>
                                <small>${new Date(ev.time).toLocaleString()} - ${ev.location}</small>
                            </div>
                            <div class="user-actions">
                                <button class="btn edit-btn" onclick="editFbdEvent('${ev.id}')">Edit</button>
                                <button class="btn delete-btn" onclick="deleteFbdEvent('${ev.id}')">Delete</button>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (e) {
                console.error(e);
                list.innerHTML = '<p style="color:red;">Error loading FBD</p>';
            }
        };
        window.editFbdEvent = function(id) {
            const ev = CACHE.fbdEvents.find(x => x.id === id);
            if (!ev) return;
            document.getElementById('fbdEventId').value = ev.id;
            document.getElementById('fbdEventTitle').value = ev.title || '';
            document.getElementById('fbdEventTime').value = ev.time ? new Date(ev.time).toISOString().slice(0,16) : '';
            document.getElementById('fbdEventLocation').value = ev.location || '';
            document.getElementById('fbdEventType').value = ev.type || 'Workshop';
            document.getElementById('fbdEventSeats').value = ev.seats ?? 0;
            document.getElementById('fbdEventImage').value = ev.image || '';
            document.getElementById('fbdEventDescription').value = ev.description || '';
            const form = document.getElementById('fbdEventForm');
            form.dataset.mode = 'edit';
            document.getElementById('fbdEventSubmitBtn').textContent = 'Update FBD Event';
        };
        window.deleteFbdEvent = async function(id) {
            const confirmMsg = (localStorage.getItem('language') || 'en') === 'ar' ? 'ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑŸÅÿπÿßŸÑŸäÿ©ÿü' : 'Are you sure you want to delete this FBD event?';
            if (!confirm(confirmMsg)) return;
            const r = await firestoreAPI.deleteFbdEvent(id);
            if (r.success) { showMessage('FBD event deleted', 'success'); loadFbd(); }
            else { showMessage(r.error || 'Failed to delete FBD event', 'error'); }
        };

        // Forms: submit handlers
        document.getElementById('eventForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const currentLang = localStorage.getItem('language') || 'en';
            const mode = e.currentTarget.dataset.mode || 'add';
            const payload = {
                title: document.getElementById('eventTitle').value.trim(),
                time: new Date(document.getElementById('eventTime').value).toISOString(),
                location: document.getElementById('eventLocation').value.trim(),
                type: document.getElementById('eventType').value,
                seats: parseInt(document.getElementById('eventSeats').value || '0', 10),
                image: document.getElementById('eventImage').value.trim(),
                description: document.getElementById('eventDescription').value.trim()
            };
            let res;
            if (mode === 'edit') res = await firestoreAPI.updateEvent(document.getElementById('eventId').value, payload);
            else res = await firestoreAPI.addEvent(payload);
            if (res.success) {
                showMessage(currentLang === 'ar' ? 'ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸÅÿπÿßŸÑŸäÿ© ÿ®ŸÜÿ¨ÿßÿ≠!' : 'Event saved successfully!', 'success');
                e.currentTarget.reset(); e.currentTarget.dataset.mode = 'add'; document.getElementById('eventSubmitBtn').textContent = 'Add Event';
                loadExistingEvents();
            } else { showMessage(res.error || 'Failed to save event', 'error'); }
        });

        document.getElementById('articleForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const currentLang = localStorage.getItem('language') || 'en';
            const mode = e.currentTarget.dataset.mode || 'add';
            const payload = {
                title: document.getElementById('articleTitle').value.trim(),
                author: document.getElementById('articleAuthor').value.trim(),
                date: document.getElementById('articleDate').value,
                summary: document.getElementById('articleSummary').value.trim(),
                content: document.getElementById('articleContent').value.trim()
            };
            let res;
            if (mode === 'edit') res = await firestoreAPI.updateArticle(document.getElementById('articleId').value, payload);
            else res = await firestoreAPI.addArticle(payload);
            if (res.success) {
                showMessage(currentLang === 'ar' ? 'ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸÇÿßŸÑ ÿ®ŸÜÿ¨ÿßÿ≠!' : 'Article saved successfully!', 'success');
                e.currentTarget.reset(); e.currentTarget.dataset.mode = 'add'; document.getElementById('articleSubmitBtn').textContent = 'Add Article';
                loadExistingArticles();
            } else { showMessage(res.error || 'Failed to save article', 'error'); }
        });

        document.getElementById('libraryForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const currentLang = localStorage.getItem('language') || 'en';
            const mode = e.currentTarget.dataset.mode || 'add';
            const tagsRaw = document.getElementById('libTags').value;
            const payload = {
                name: document.getElementById('libName').value.trim(),
                type: document.getElementById('libType').value,
                tags: tagsRaw ? tagsRaw.split(',').map(t => t.trim()).filter(Boolean) : [],
                image: document.getElementById('libImage').value.trim(),
                description: document.getElementById('libDescription').value.trim(),
                link: document.getElementById('libLink').value.trim()
            };
            let res;
            if (mode === 'edit') res = await firestoreAPI.updateLibraryResource(document.getElementById('libId').value, payload);
            else res = await firestoreAPI.addLibraryResource(payload);
            if (res.success) {
                showMessage(currentLang === 'ar' ? 'ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑŸÖŸàÿ±ÿØ ÿ®ŸÜÿ¨ÿßÿ≠!' : 'Resource saved successfully!', 'success');
                e.currentTarget.reset(); e.currentTarget.dataset.mode = 'add'; document.getElementById('libSubmitBtn').textContent = 'Add Resource';
                loadExistingLibraryResources();
            } else { showMessage(res.error || 'Failed to save resource', 'error'); }
        });

        document.getElementById('educationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const currentLang = localStorage.getItem('language') || 'en';
            const payload = {
                weekTitle: document.getElementById('weekTitle').value.trim(),
                lecturerName: document.getElementById('lecturerName').value.trim(),
                description: document.getElementById('weekDescription').value.trim()
            };
            const res = await firestoreAPI.updateEducation(payload);
            if (res.success) showMessage(currentLang === 'ar' ? 'ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ™ÿπŸÑŸäŸÖŸä!' : 'Education content updated!', 'success');
            else showMessage(res.error || 'Failed to update education content', 'error');
        });

        document.getElementById('courseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const mode = e.currentTarget.dataset.mode || 'add';
            const payload = {
                title: document.getElementById('courseTitle').value.trim(),
                description: document.getElementById('courseDescription').value.trim(),
                lecturer: document.getElementById('courseLecturer').value.trim(),
                link: document.getElementById('courseLink').value.trim()
            };
            let res;
            if (mode === 'edit') res = await firestoreAPI.updateCourse(document.getElementById('courseId').value, payload);
            else res = await firestoreAPI.addCourse(payload);
            if (res.success) {
                showMessage('Course saved', 'success');
                e.currentTarget.reset(); e.currentTarget.dataset.mode = 'add'; document.getElementById('courseSubmitBtn').textContent = 'Add Course';
                loadCourses();
            } else { showMessage(res.error || 'Failed to save course', 'error'); }
        });

        document.getElementById('fbdPageForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const res = await firestoreAPI.updateFbdPage({
                pageTitle: document.getElementById('fbdTitle').value.trim(),
                about: document.getElementById('fbdAbout').value.trim()
            });
            if (res.success) showMessage('FBD page updated', 'success');
            else showMessage(res.error || 'Failed to update FBD page', 'error');
        });

        document.getElementById('fbdEventForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const mode = e.currentTarget.dataset.mode || 'add';
            const payload = {
                title: document.getElementById('fbdEventTitle').value.trim(),
                time: new Date(document.getElementById('fbdEventTime').value).toISOString(),
                location: document.getElementById('fbdEventLocation').value.trim(),
                type: document.getElementById('fbdEventType').value,
                seats: parseInt(document.getElementById('fbdEventSeats').value || '0', 10),
                image: document.getElementById('fbdEventImage').value.trim(),
                description: document.getElementById('fbdEventDescription').value.trim()
            };
            let res;
            if (mode === 'edit') res = await firestoreAPI.updateFbdEvent(document.getElementById('fbdEventId').value, payload);
            else res = await firestoreAPI.addFbdEvent(payload);
            if (res.success) {
                showMessage('FBD event saved', 'success');
                e.currentTarget.reset(); e.currentTarget.dataset.mode = 'add'; document.getElementById('fbdEventSubmitBtn').textContent = 'Add FBD Event';
                loadFbd();
            } else { showMessage(res.error || 'Failed to save FBD event', 'error'); }
        });

        // Settings helpers
        window.testFirestoreConnection = async function() {
            const statusEl = document.getElementById('tokenStatusText');
            statusEl.textContent = 'Testing...';
            const res = await firestoreAPI.testConnection();
            statusEl.textContent = res.success ? 'Connected' : `Error: ${res.error}`;
            document.getElementById('tokenStatus').style.background = res.success ? '#f0fff4' : '#fff5f5';
        };
        window.updateTokenStatus = function() { testFirestoreConnection(); };

        window.loadAdminsList = async function() {
            const list = document.getElementById('adminsList');
            list.innerHTML = '<p>Loading...</p>';
            const res = await firestoreAPI.getAdmins();
            if (!res.success) { list.innerHTML = `<p style="color:red;">${res.error}</p>`; return; }
            if ((res.admins || []).length === 0) { list.innerHTML = '<p>No admins found.</p>'; return; }
            list.innerHTML = res.admins.map(a => `<div class="content-item"><div>${a}</div></div>`).join('');
        };
        window.addNewAdmin = async function() {
            const input = document.getElementById('newAdminEmail');
            const email = input.value.trim();
            if (!email) return;
            const res = await firestoreAPI.addAdmin(email);
            if (res.success) { input.value = ''; loadAdminsList(); showMessage('Admin added', 'success'); }
            else { showMessage(res.error || 'Failed to add admin', 'error'); }
        };
    </script>
</body>
</html>
