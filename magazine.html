<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magazine - AIAS Basra Chapter</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Authentication Check -->
    <script type="module" src="js/auth.js"></script>
    <style>
        .magazine-hero {
            background: var(--gradient-1);
            color: var(--white);
            padding: 8rem 0 4rem;
            text-align: center;
        }
        
        .magazine-hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .featured-article {
            padding: 5rem 0;
            background: var(--light-bg);
        }
        
        .featured-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: center;
        }
        
        .featured-image {
            height: 400px;
            background: var(--gradient-2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6rem;
            box-shadow: var(--shadow-lg);
        }
        
        .featured-text h2 {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .article-date {
            color: var(--accent-color);
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .featured-text p {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 1.5rem;
        }
        
        .articles-section {
            padding: 5rem 0;
        }
        
        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
        }
        
        .article-card {
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            transition: all 0.4s ease;
            cursor: pointer;
            perspective: 1000px;
        }
        
        .article-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-xl);
        }
        
        .article-image {
            height: 220px;
            background: var(--gradient-2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            position: relative;
            overflow: hidden;
        }
        
        .article-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.3) 100%);
        }
        
        .article-category {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: var(--white);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--primary-color);
            z-index: 1;
        }
        
        .article-content {
            padding: 1.5rem;
        }
        
        .article-meta {
            display: flex;
            gap: 1rem;
            color: var(--text-light);
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }
        
        .article-title {
            font-size: 1.25rem;
            color: var(--primary-color);
            margin-bottom: 0.75rem;
            font-weight: 600;
            line-height: 1.4;
        }
        
        .article-excerpt {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .read-more {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--accent-color);
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .read-more:hover {
            gap: 1rem;
        }
        
        @media (max-width: 768px) {
            .magazine-hero h1 {
                font-size: 2rem;
            }
            
            .featured-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="container">
            <div class="nav-content">
                <div class="logo">
                    <img src="LOGO.png" alt="AIAS Basra Logo">
                    <span>AIAS Basra</span>
                </div>
                <button class="menu-toggle" id="menuToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <ul class="nav-links" id="navLinks">
                    <li><a href="index.html" data-en="Home" data-ar="ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©">Home</a></li>
                    <li><a href="about.html" data-en="About Us" data-ar="ŸÖŸÜ ŸÜÿ≠ŸÜ">About Us</a></li>
                    <li><a href="library.html" data-en="Library" data-ar="ÿßŸÑŸÖŸÉÿ™ÿ®ÿ©">Library</a></li>
                    <li><a href="magazine.html" class="active" data-en="Magazine" data-ar="ÿßŸÑŸÖÿ¨ŸÑÿ©">Magazine</a></li>
                    <li><a href="events.html" data-en="Events" data-ar="ÿßŸÑŸÅÿπÿßŸÑŸäÿßÿ™">Events</a></li>
                    <li><a href="education.html" data-en="Education" data-ar="ÿßŸÑÿ™ÿπŸÑŸäŸÖ">Education</a></li>
                    <li>
                        <button class="language-toggle" id="languageToggle">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                            </svg>
                            <span id="currentLang">EN</span>
                        </button>
                    </li>
                    <li id="dashboardBtn" style="display: none;"><a href="admin-dashboard.html" class="nav-btn nav-btn-signup" data-en="Dashboard" data-ar="ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ">Dashboard</a></li>
                    <li id="loginBtn"><a href="login.html" class="nav-btn nav-btn-login" data-en="Login" data-ar="ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ">Login</a></li>
                    <li id="signupBtn"><a href="signup.html" class="nav-btn nav-btn-signup" data-en="Sign Up" data-ar="ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®">Sign Up</a></li>
                    <li id="userProfile" style="display: none;">
                        <span id="userName" style="color: #667eea; font-weight: 600; margin-right: 10px;"></span>
                        <a href="#" id="logoutBtn" class="nav-btn nav-btn-login" data-en="Logout" data-ar="ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Magazine Hero -->
    <section class="magazine-hero">
        <div class="container">
            <h1 class="fade-in-up" data-en="Magazine & Articles" data-ar="ÿßŸÑŸÖÿ¨ŸÑÿ© ŸàÿßŸÑŸÖŸÇÿßŸÑÿßÿ™">Magazine & Articles</h1>
            <p class="fade-in-up delay-1" data-en="Explore insights, trends, and stories from the world of architecture" data-ar="ÿßÿ≥ÿ™ŸÉÿ¥ŸÅ ÿßŸÑÿ£ŸÅŸÉÿßÿ± ŸàÿßŸÑÿßÿ™ÿ¨ÿßŸáÿßÿ™ ŸàÿßŸÑŸÇÿµÿµ ŸÖŸÜ ÿπÿßŸÑŸÖ ÿßŸÑŸáŸÜÿØÿ≥ÿ© ÿßŸÑŸÖÿπŸÖÿßÿ±Ÿäÿ©">Explore insights, trends, and stories from the world of architecture</p>
        </div>
    </section>

    <!-- Featured Article -->
    <section class="featured-article">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title" data-en="Featured Article" data-ar="ÿßŸÑŸÖŸÇÿßŸÑ ÿßŸÑŸÖŸÖŸäÿ≤">Featured Article</h2>
            </div>
            <div class="featured-content" id="featuredContent">
                <!-- Featured article will be loaded dynamically -->
            </div>
        </div>


    <!-- Articles Section -->
    <section class="articles-section">

    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>AIAS Basra Chapter</h3>
                    <p>American Institute of Architecture Students - Basra Chapter</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="events.html">Events</a></li>
                        <li><a href="library.html">Library</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact Us</h4>
                    <p style="margin-bottom: 0.5rem;">
                        <a href="mailto:basrah@aias.org" style="color: inherit; text-decoration: none;">
                            üìß basrah@aias.org
                        </a>
                    </p>
                    <p style="margin-bottom: 0.5rem;">
                        <a href="https://instagram.com/aias.bsr" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none;">
                            üì∑ Instagram: @aias.bsr
                        </a>
                    </p>
                    <p style="margin-bottom: 0.5rem;">
                        <a href="https://x.com/aiasbasra" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none;">
                            ùïè X: @aiasbasra
                        </a>
                    </p>
                    <p style="margin-bottom: 0.5rem;">
                        <a href="https://www.tiktok.com/@aiasbsr" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none;">
                            üéµ TikTok: @aiasbsr
                        </a>
                    </p>
                    <p style="margin-bottom: 1rem;">
                        <a href="https://www.facebook.com/share/19mEUHcFQs/?mibextid=wwXIfr" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none;">
                            üìò Facebook
                        </a>
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 AIAS Basra Chapter. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/three-effects.js"></script>
    <script src="js/main.js"></script>
    <script type="module">
        // Import Data Loader
        import dataLoader from "./js/data-loader.js";

        // Debug toggle: enable via ?debug=true or localStorage.setItem('debug','true')
        const DEBUG =
          (new URLSearchParams(window.location.search).has('debug') ||
           localStorage.getItem('debug') === 'true');

        // Load magazine data from Firebase using Data Loader
        async function loadMagazine() {
            const featuredContent = document.getElementById('featuredContent');
            const gridContainer = document.querySelector('.articles-grid');
            
            // Show loading state
            if (featuredContent) {
                featuredContent.innerHTML = `
                    <div class="loading-container">
                        <div class="loading-spinner"></div>
                        <p class="loading-text">Loading magazine content...</p>
                    </div>
                `;
            }
            if (gridContainer) {
                gridContainer.innerHTML = `
                    <div class="loading-container">
                        <div class="loading-spinner"></div>
                        <p class="loading-text">Loading articles...</p>
                    </div>
                `;
            }
            
            try {
                console.log('[Magazine] Loading magazine using Data Loader...');
                
                // Use Data Loader to fetch magazine
                const result = await dataLoader.getMagazine();
                
                if (!result.success) {
                    throw new Error(result.error || 'Failed to load magazine');
                }
                
                const magazineData = result.magazine;
                console.log('[Magazine] ‚úì Magazine content loaded');
                
                // Debug logging
                if (DEBUG) {
                    const articlesCount = magazineData?.articles?.length || 0;
                    const hasFeatured = !!magazineData?.featuredArticle;
                    console.log(`[Magazine] Debug mode enabled - Articles: ${articlesCount}, Has Featured: ${hasFeatured}`);
                    if (magazineData?.featuredArticle) {
                        console.log('[Magazine] Featured article:', magazineData.featuredArticle.title);
                    }
                }
                
                if (magazineData) {
                    // Load featured article
                    if (magazineData.featuredArticle && featuredContent) {
                        const featured = magazineData.featuredArticle;
                        const dateInfo = dataLoader.formatDate(featured.date);
                        
                        // Only show if date is valid
                        if (dateInfo) {
                            featuredContent.innerHTML = `
                                <div class="featured-image reveal">${featured.image || 'üèóÔ∏è'}</div>
                                <div class="featured-text reveal">
                                    <div class="article-date">üìÖ ${dateInfo.month} ${dateInfo.year}</div>
                                    <h2>${featured.title}</h2>
                                    <p>${featured.summary}</p>
                                    <p>${featured.content || ''}</p>
                                    <a href="#" class="btn btn-primary">Read Full Article</a>
                                </div>
                            `;
                        } else {
                            console.warn('[Magazine] Featured article has invalid date');
                            featuredContent.innerHTML = `
                                <div class="empty-state">
                                    <div class="empty-icon">üì∞</div>
                                    <h3 class="empty-title">No Featured Article</h3>
                                    <p class="empty-message">Check back soon for our featured content!</p>
                                </div>
                            `;
                        }
                    } else if (featuredContent) {
                        featuredContent.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">üì∞</div>
                                <h3 class="empty-title">No Featured Article</h3>
                                <p class="empty-message">Check back soon for our featured content!</p>
                            </div>
                        `;
                    }
                    
                    // Load articles grid
                    if (magazineData.articles && magazineData.articles.length > 0 && gridContainer) {
                        gridContainer.innerHTML = '';
                        
                        // Show all or skip first if it's featured
                        const articlesToShow = magazineData.featuredArticle ? magazineData.articles.slice(1) : magazineData.articles;
                        
                        articlesToShow.forEach((article, index) => {
                            const dateInfo = dataLoader.formatDate(article.date);
                            
                            // Skip articles with invalid dates
                            if (!dateInfo) {
                                console.warn('[Magazine] Skipping article with invalid date:', article.title);
                                return;
                            }
                            
                            const categories = ['Design', 'Sustainability', 'Technology', 'History', 'Inspiration', 'Community'];
                            const category = categories[index % categories.length];
                            
                            const articleCard = `
                                <div class="article-card reveal">
                                    <div class="article-image">
                                        ${['üìê', 'üåø', 'üíª', 'üèõÔ∏è', 'üé®', 'üë•'][index % 6]}
                                        <span class="article-category">${category}</span>
                                    </div>
                                    <div class="article-content">
                                        <div class="article-meta">
                                            <span>üìÖ ${dateInfo.month} ${dateInfo.day}, ${dateInfo.year}</span>
                                            <span>‚è±Ô∏è 5 min read</span>
                                        </div>
                                        <h3 class="article-title">${article.title}</h3>
                                        <p class="article-excerpt">
                                            ${article.summary}
                                        </p>
                                        <a href="#" class="read-more">Read More ‚Üí</a>
                                    </div>
                                </div>
                            `;
                            gridContainer.innerHTML += articleCard;
                        });
                    } else if (gridContainer) {
                        gridContainer.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">üìÑ</div>
                                <h3 class="empty-title">No Articles Available</h3>
                                <p class="empty-message">New articles coming soon!</p>
                            </div>
                        `;
                    }
                } else {
                    // Show empty state for all containers
                    if (featuredContent) {
                        featuredContent.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon">üì∞</div>
                                <h3 class="empty-title">No Content Available</h3>
                                <p class="empty-message">Magazine content is being prepared. Check back soon!</p>
                            </div>
                        `;
                    }
                    if (gridContainer) {
                        gridContainer.innerHTML = '';
                    }
                }
            } catch (error) {
                console.error('[Magazine] ‚úó Error loading magazine:', error);
                // Show error state
                if (featuredContent) {
                    featuredContent.innerHTML = `
                        <div class="error-container">
                            <div class="error-icon">‚ö†Ô∏è</div>
                            <h3 class="error-title">Unable to Load Magazine</h3>
                            <p class="error-message">There was a problem loading the magazine content. Please check your connection and try again.</p>
                            <button class="retry-btn" onclick="location.reload()">Try Again</button>
                        </div>
                    `;
                }
                if (gridContainer) {
                    gridContainer.innerHTML = '';
                }
            }
        }
        
        // Load magazine when page loads
        document.addEventListener('DOMContentLoaded', loadMagazine);
    </script>
</body>
</html>
